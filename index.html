<!DOCTYPE html>
<html lang="en">

<head>
    <!--Provides an HTTP header for the information/value of content attribute-->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <!--Setting the viewport to make website look good on all devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Specifies the URL of external script file (absolute URL)-->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!--Title of HTML Page-->
    <title>Singapore Population Choropleth</title>

    <style></style>
</head>

<svg></svg>
<script>

    let width = 1000, height = 600;
    
    let svg = d3.select("svg")
        .attr("viewBox", "0 0 " + width + " " + height)

    let dataMap = new Map();
    
    // Load external data
    Promise.all([d3.json("sgmap.json"), d3.csv("population2021.csv", function(loadData){
        dataMap.set(loadData.Subzone.toUpperCase(), loadData.Population)
    })]).then(data => {
    
    console.log(dataMap);
    
    // Colorscale
    var colorScale = d3.scaleThreshold()
    .domain([500, 1000, 2000, 3000, 4000, 5000, 6000, 8000])
    .range(d3.schemeBlues[8]);

    // Map and projection
    var projection = d3.geoMercator()
        .center([103.851959, 1.290270])
        .fitExtent([[20, 20], [980, 580]], data[0]);
    
    let geopath = d3.geoPath().projection(projection);
    var tooltip = d3.select(".tooltip").style("opacity", 0)
    
    svg.append("g")
        .attr("id", "districts")
        .selectAll("path")
        .data(data[0].features)
        .enter()
        .append("path")
        .attr("d", geopath)
        .attr("fill", function(loadData){
            loadData.total = dataMap.get(loadData.properties.Name) || 0;
            return colorScale(loadData.total);
        })
        .style("stroke", "pink")
        .style("stroke-width", 1)
        .style("opacity", 4)
    })
    
    </script>
    </body>
    </html>